<!doctype html>
<html lang="<%= locale %>">
<head>
    <meta charset="utf-8">
<!-- Google Tag Manager -->
<script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id=GTM-TF7HSC3N'+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-TF7HSC3N');
</script>
<!-- Fin Google Tag Manager -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#C4B990">
    <title>UAP Immo | <%= i18n.my_profile %></title>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/bootstrap-icons.css" rel="stylesheet">
    <link rel="preload" href="/css/styles-main.css" as="style">
    <link rel="stylesheet" href="/css/styles-main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
        html, body {
            height: 100%;
        }
        body {
            display: flex;
            flex-direction: column;
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
            margin: 0;
        }
        h3 {
            color: #000;
            text-align: left;
        }
        .navbar {
            background-color: #C4B990;
            margin-bottom: 20px;
        }
        .navbar .navbar-brand, .navbar .nav-link, .navbar .navbar-icon {
            color: #000;
        }
        .navbar .navbar-icon {
            color: #000;
        }
        .main-section {
            flex: 1;
            padding: 20px;
            background-color: #fff;
            margin-left: 10px;
            min-height: 500px;
        }
        .main-section .card {
            border: none;
            box-shadow: none;
        }
        .sidebar {
            background-color: #8f97c4;
            border-radius: 60px;
            box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.8);
            padding: 20px;
            width: 60px;
            height: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: sticky;
            top: 20px;
        }
        .sidebar a {
            margin: 10px 0;
            color: #000;
            font-size: 24px;
            text-decoration: none;
        }
        .sidebar a:hover {
            color: #000;
        }
        .footer {
            background-color: #343a40;
            color: #fff;
            padding: 20px 0;
        }
        .btn-custom {
            background-color: #8f97c4;
            color: #000;
            border: none;
        }
        .btn-custom:hover {
            background-color: #8f97c4;
            color: #000;
        }
        .btn-custom i {
            font-size: 24px;
        }
        .tooltip {
            position: absolute;
            background-color: #ADD8E6;
            color: #000;
            padding: 5px 10px;
            border-radius: 4px;
            white-space: nowrap;
            z-index: 1000;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
        }
        .copy-message {
            display: none;
            background-color: #d1e7dd;
            color: #0f5132;
            padding: 10px;
            border-radius: 5px;
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
        }
        .action-icons i {
            font-size: 24px;
            cursor: pointer;
            margin-right: 10px;
            color: #333;
        }
        .short-column {
            width: 10%;
        }
        .card-title {
            font-weight: 400;
            font-size: 1.6rem;
            color: #000;
            margin-bottom: 0.5rem;
        }
        .card-text {
            font-size: 1.1rem;
            line-height: 1.8rem;
            color: #666;
            margin-bottom: 1rem;
            letter-spacing: 0.5px;
        }
        .card-body .user-info {
            color: #333;
            margin-bottom: 0.2rem;
            line-height: 1.6rem;
        }
.hidden {
    display: none;
}

progress {
    width: 100%;
    height: 10px;
    margin-top: 5px;
}
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
}
input[type="number"] {
    -moz-appearance: textfield;
}
.form-group {
    margin-bottom: 15px;
}

.form-group label {
    color: #333;
    display: block;
    margin-bottom: 5px;
}

.form-control {
    width: 50%;
    padding: 10px;
    font-size: 16px;
    border: 1px solid #8f97c4;
    border-radius: 5px;
    transition: border 0.3s ease-in-out;
}

/* Effet focus */
.form-control:focus {
    border-color: #8f97c4; /* Bleu */
    outline: none;
    box-shadow: 0 0 5px rgba(143, 151, 196, 0.5);
}




        @media (max-width: 767px) {
            .container-fluid {
                padding-left: 0;
                padding-right: 0;
            }
            .container {
                padding-left: 15px;
                padding-right: 15px;
            }
            .row {
                flex-direction: column;
                align-items: center;
            }
            .main-section {
                margin-left: 0;
                margin-right: 0;
                margin-top: 0;
                width: 100%;
                border-radius: 0;
                box-shadow: none;
                min-height: 300px;
                overflow-x: auto;
                padding-left: 0;
                padding-right: 0;
            }
            .sidebar {
                display: none;
            }
            .sidebar-mobile-links {
                display: block !important;
                margin-top: 10px;
            }
            .mobile-margin {
                margin-top: 30px;
            }
            table {
                width: 100%;
                table-layout: auto;
            }
            th, td {
                white-space: nowrap;
                padding: 8px;
                text-align: left;
            }
            .table-responsive {
                display: block;
                width: 100%;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            #landing .form-group {
                width: 100%;
                padding: 5px;
            }
            #landing .form-control {
                width: 100%;
                padding: 10px;
                font-size: 16px;
            }
            #landing button.btn-custom {
                width: 100%;
                padding: 10px;
                font-size: 18px;
            }
            .card-title {
                font-weight: 400;
                font-size: 1.4rem;
                color: #000;
                margin-bottom: 0.5rem;
            }
            .card-text {
                font-size: 1.1rem;
                line-height: 1.8rem;
                color: #666;
                margin-bottom: 1rem;
                letter-spacing: 0.5px;
            }
            .card-body .user-info {
                color: #333;
                margin-bottom: 0.2rem;
                line-height: 1.2rem;
            }
.hidden {
    display: none;
}

progress {
    width: 100%;
    height: 10px;
    margin-top: 5px;
}
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
}
input[type="number"] {
    -moz-appearance: textfield;
}

        }
        @media (min-width: 768px) {
            .sidebar-links {
                display: none;
            }
            .card-title {
                font-size: 1.475rem;
                font-weight: 400;
                color: #000;
            }
            .card-text {
                font-size: 1rem;
                line-height: 1.6rem;
                letter-spacing: 0.4px;
            }
.hidden {
    display: none;
}

progress {
    width: 100%;
    height: 10px;
    margin-top: 5px;
}
        }
    </style>
</head>
<body id="top">
<script>
  window.dataLayer = window.dataLayer || [];
  window.dataLayer.push({
    'event': 'userLogin',
    'userID': "<%= user ? user._id : 'Guest' %>",
    'pageTitle': document.title
  });
</script>
 <!-- Google Tag Manager (noscript) -->
    <noscript>
      <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TF7HSC3N" 
      height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- Fin Google Tag Manager (noscript) -->
    <main>
      <body id="top">
    <main>
       <nav class="navbar navbar-expand-lg fixed-top">
    <div class="container">
        <a class="navbar-brand" href="/">
            <span>UAP Immo</span>
        </a>
        <div class="d-lg-none ms-auto me-4">
            <% if (user) { %>
                <form action="/<%= locale %>/logout" method="POST" class="d-inline" onsubmit="event.preventDefault(); window.location.href = '/<%= locale %>/login';">
    <button type="submit" style="background: none; border: none; position: relative;">
        <i class="bi bi-person-circle" style="font-size: 1.8rem; color: black;"></i>
        <i class="bi bi-x-circle" style="font-size: 0.8rem; color: red; position: absolute; top: 0; right: 0;"></i>
        <span class="visually-hidden"><%= i18n.menu.logout %></span>
    </button>
</form>
            <% } else { %>
                <a href="/login" style="position: relative;">
                    <i class="bi bi-person-circle" style="font-size: 1.8rem; color: black;"></i>
                    <span class="visually-hidden"><%= i18n.menu.login %></span>
                </a>
            <% } %>
        </div>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-lg-5 me-lg-auto">
                <li class="nav-item">
                    <a class="nav-link click-scroll" href="/"><%= i18n.menu.home %></a>
                </li>
              
                <li class="nav-item">
                    <a class="nav-link click-scroll" href="/#contact"><%= i18n.menu.contact %></a>
                </li>
                <!-- Sidebar links for mobile -->
                <li class="nav-item sidebar-mobile-links sidebar-links">
                    <a class="nav-link click-scroll" href="#" onclick="showSection('account')"><i class="fa fa-user"></i> <%= i18n.my_profile %></a>
                </li>
                <li class="nav-item sidebar-mobile-links sidebar-links">
                    <a class="nav-link click-scroll" href="#" onclick="showSection('landing')"><i class="fa fa-file-alt"></i> <%= i18n.add_property %></a>
                </li>
                <li class="nav-item sidebar-mobile-links sidebar-links">
                    <a class="nav-link click-scroll" href="#" onclick="showSection('donnees')"><i class="fa-solid fa-chart-line"></i> <%= i18n.stats %></a>
                </li>
                <li class="nav-item sidebar-mobile-links sidebar-links">
                    <a class="nav-link click-scroll" href="#" onclick="showSection('created-pages')"><i class="fa fa-wallet"></i> <%= i18n.created_pages %></a>
                </li>
            </ul>
            <div class="d-none d-lg-block">
                <% if (user) { %>
                    <form action="/<%= locale %>/logout" method="POST" class="d-inline" onsubmit="event.preventDefault(); window.location.href = '/<%= locale %>/login';">
    <button type="submit" style="background: none; border: none; position: relative;">
        <i class="bi bi-person-circle" style="font-size: 1.8rem; color: black;"></i>
        <i class="bi bi-x-circle" style="font-size: 0.8rem; color: red; position: absolute; top: 0; right: 0;"></i>
        <span class="visually-hidden"><%= i18n.menu.logout %></span>
    </button>
</form>
                <% } else { %>
                    <a href="/login" style="position: relative;">
                        <i class="bi bi-person-circle" style="font-size: 1.8rem; color: black;"></i>
                        <span class="visually-hidden"><%= i18n.menu.login %></span>
                    </a>
                <% } %>
            </div>
        <div class="dropdown d-none d-lg-block ms-3">
                <button class="btn btn-link dropdown-toggle" type="button" id="languageDropdown" data-bs-toggle="dropdown" aria-expanded="false" style="text-decoration: none; color: #000;">
                    <%= locale === 'fr' ? 'FR' : 'EN' %>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="languageDropdown">
                    <li>
                        <a class="dropdown-item" href="/fr/login">FR</a>
                    </li>
                    <li>
                        <a class="dropdown-item" href="/en/login">EN</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
        </div>
    </div>
</nav>

<section class="contact-section section-padding section-bg" id="section_5">
    <div class="container">
        <h5 class="text-black mobile-margin">
            <% if (user) { %>
                <%= i18n.welcome_user.replace('{lastName}', user.lastName).replace('{firstName}', user.firstName) %>
            <% } else { %>
                <%= i18n.welcome_guest %>
            <% } %>
        </h5>
        <div class="container-fluid">
            <div class="row mt-4">
                <div class="col-auto p-0">
                    <div class="sidebar">
                        <a href="#" title="<%= i18n.my_profile %>" onclick="showSection('account')"><i class="fa fa-user"></i></a>
                        <a href="#" title="<%= i18n.add_property %>" onclick="showSection('landing')"><i class="fa fa-file-alt"></i></a>
                        <a href="#" title="<%= i18n.stats %>" onclick="showSection('donnees')"><i class="fa-solid fa-chart-line"></i></a>
                        <a href="#" title="<%= i18n.created_pages %>" onclick="showSection('created-pages')"><i class="fa fa-wallet"></i></a>
                    </div>
                </div>
                <div class="col">
                    <div class="main-section">
                        <!-- Section Account -->
                        <div id="account" class="card">
                            <div class="card-body">
                                <h5 class="card-title"><%= i18n.my_profile %></h5>
                                <p class="card-text"><%= i18n.profile_info %></p>
                                <p class="card-text user-info"><%= i18n.name %>: <%= user.firstName %></p>
                                <p class="card-text user-info"><%= i18n.first_name %>: <%= user.lastName %></p>
                                <p class="card-text user-info"><%= i18n.email %>: <%= user.email %></p>

                                <!-- Bouton qui montre la section de r√©initialisation du mot de passe -->
                                <button type="button" class="btn btn-outline-dark" onclick="showSection('reset-password')"><%= i18n.reset_password %></button>
                            </div>
<div id="order-history" class="card">
    <div class="card-body">
        <h5 class="card-title">Historique des Commandes</h5>
        <p class="card-text">Consultez votre historique de commandes pass√©es.</p>
        <div class="table-responsive">
            <table class="table table-striped" id="order-history-table">
                <thead>
                  <tbody id="order-history-table-body">
    <% if (!orders || orders.length === 0) { %>
        <tr>
            <td colspan="5" class="text-center">Aucune commande trouv√©e.</td>
        </tr>
    <% } else { %>
        <% orders.forEach(order => { %>
            <tr>
                <td><%= new Date(order.createdAt).toLocaleDateString('fr-FR') %></td>
                <td><%= new Date(order.createdAt).toLocaleTimeString('fr-FR') %></td>
                <td><%= (order.amount / 100).toFixed(2) %> ‚Ç¨</td>
                <td><%= order.status %></td>
                <td>
                    <% if (order.pageUrl) { %>
                        <a href="<%= order.pageUrl %>" target="_blank">Voir</a>
                    <% } else { %>
                        URL non disponible
                    <% } %>
                </td>
            </tr>
        <% }) %>
    <% } %>
</tbody>



                <tbody>
                    <!-- Les commandes seront ins√©r√©es ici -->
                </tbody>
            </table>
        </div>
        <div id="no-orders-message" style="display: none;" class="text-center">
            <p>Aucune commande trouv√©e.</p>
        </div>
    </div>
</div>

                        </div>

                        <!-- Section Reset Password -->
                        <div id="reset-password" class="card" style="display: none;">
                            <div class="card-body">
                                <h5 class="card-title"><%= i18n.reset_password %></h5>
                                <p class="card-text"><%= i18n.password_reset_instructions %></p>
                                <form id="reset-password-form" action="/user/reset-password" method="POST">
                                    <div class="form-group">
                                        <label for="email"><%= i18n.email_label %></label>
                                        <input type="email" class="form-control" id="email" name="email" required>
                                    </div>
                                    <button type="submit" class="btn btn-outline-dark"><%= i18n.send_reset_link %></button>
                                </form>
                            </div>
                        </div>

                        <!-- Section Landing Page -->
                        <div id="landing" class="card" style="display: none;">
                            <div class="card-body">
                                <h5 class="card-title"><%= i18n.add_property %></h5>
                                <p class="card-text"><%= i18n.property_details %></p>
                                <h5 class="card-title"><%= i18n.add_property %></h5>
                                <form id="add-property-form" action="/add-property" method="POST" enctype="multipart/form-data">
  <input type="hidden" id="userId" name="userId" value="<%= user._id %>">
  <div class="form-group">
    <label for="rooms"><%= i18n.rooms %></label>
    <input type="number" class="form-control" id="rooms" name="rooms" required>
  </div>
  <div class="form-group">
    <label for="bedrooms">Nombre de chambres</label>
    <input type="number" class="form-control" id="bedrooms" name="bedrooms" required>
  </div>
  <div class="form-group">
    <label for="surface"><%= i18n.surface %> :</label>
    <input type="number" class="form-control" id="surface" name="surface" required>
  </div>
  <div class="form-group">
    <label for="price"><%= i18n.price %> :</label>
    <input type="number" class="form-control" id="price" name="price" required>
  </div>
   <div class="form-group">
    <label for="country"><%= i18n.country %> :</label>
    <input type="text" class="form-control" id="country" name="country" required>
  </div>

  <div class="form-group">
    <label for="city"><%= i18n.city %> :</label>
    <input type="text" class="form-control" id="city" name="city" required>
  </div>

  <!-- Ann√©e de construction -->
  <div class="form-group">
    <label for="yearBuilt">Ann√©e de construction</label>
    <input type="number" class="form-control" id="yearBuilt" name="yearBuilt">
  </div>
  <!-- Piscine -->
  <div class="form-group">
    <label for="pool">Piscine</label>
    <select class="form-control" id="pool" name="pool">
      <option value="false">Non</option>
      <option value="true">Oui</option>
    </select>
  </div>
  <!-- Type de bien -->
  <div class="form-group">
    <label for="propertyType"><%= i18n.propertyType %>Type de bien :</label>
    <select class="form-control" id="propertyType" name="propertyType" required>
      
      <option value="Propri√©t√©"><%= i18n.property %>Propri√©t√©</option>
      <option value="Villa"><%= i18n.villa %>Villa</option>
      <option value="H√¥tel particulier"><%= i18n.hotel_particulier %>Hotel particulier</option>
      <option value="Appartement"><%= i18n.apartment %>Appartement</option>
      <option value="Chateau"><%= i18n.chateau %>Chateau</option>
      <option value="Maison"><%= i18n.house %>Maison de ville</option>
    </select>
  </div>
<div class="form-group">
    <label for="bathrooms">Salles de douche</label>
    <input type="number" class="form-control" id="bathrooms" name="bathrooms">
  </div>
  <div class="form-group">
    <label for="toilets">Toilettes</label>
    <input type="number" class="form-control" id="toilets" name="toilets">
  </div>
  <div class="form-group">
    <label for="elevator">Ascenseur</label>
    <select class="form-control" id="elevator" name="elevator">
      <option value="false">Non</option>
      <option value="true">Oui</option>
    </select>
  </div>
  <div class="form-group">
    <label for="fireplace">Chemin√©e</label>
    <select class="form-control" id="fireplace" name="fireplace">
      <option value="false">Non</option>
      <option value="true">Oui</option>
    </select>
  </div>
  <div class="form-group">
    <label for="internet">Internet</label>
    <select class="form-control" id="internet" name="internet">
      <option value="false">Non</option>
      <option value="true">Oui</option>
    </select>
  </div>
  <div class="form-group">
    <label for="doubleGlazing">Double vitrage</label>
    <select class="form-control" id="doubleGlazing" name="doubleGlazing">
      <option value="false">Non</option>
      <option value="true">Oui</option>
    </select>
  </div>
  <div class="form-group">
    <label for="wateringSystem">Arrosage</label>
    <select class="form-control" id="wateringSystem" name="wateringSystem">
      <option value="false">Non</option>
      <option value="true">Oui</option>
    </select>
  </div>
  <div class="form-group">
    <label for="barbecue">Barbecue</label>
    <select class="form-control" id="barbecue" name="barbecue">
      <option value="false">Non</option>
      <option value="true">Oui</option>
    </select>
  </div>
  <div class="form-group">
    <label for="carShelter">Abri de voiture</label>
    <select class="form-control" id="carShelter" name="carShelter">
      <option value="false">Non</option>
      <option value="true">Oui</option>
    </select>
  </div>
  <div class="form-group">
    <label for="parking">Parking</label>
    <select class="form-control" id="parking" name="parking">
      <option value="false">Non</option>
      <option value="true">Oui</option>
    </select>
  </div>
  <div class="form-group">
    <label for="caretakerHouse">Maison de gardien</label>
    <select class="form-control" id="caretakerHouse" name="caretakerHouse">
      <option value="false">Non</option>
      <option value="true">Oui</option>
    </select>
  </div>
  <div class="form-group">
    <label for="electricShutters">Stores √©lectriques</label>
    <select class="form-control" id="electricShutters" name="electricShutters">
      <option value="false">Non</option>
      <option value="true">Oui</option>
    </select>
  </div>
  <div class="form-group">
    <label for="outdoorLighting">√âclairage ext√©rieur</label>
    <select class="form-control" id="outdoorLighting" name="outdoorLighting">
      <option value="false">Non</option>
      <option value="true">Oui</option>
    </select>
  </div>
 <div class="form-group">
    <label for="photo1"><%= i18n.photo_1 %></label>
    <input type="file" class="form-control" id="photo1" name="photo1" accept="image/*" required>
    <progress id="progress1" value="0" max="100" class="hidden"></progress>
    <span id="status1" class="hidden">Chargement...</span>
</div>

<div class="form-group">
    <label for="photo2"><%= i18n.photo_2 %></label>
    <input type="file" class="form-control" id="photo2" name="photo2" accept="image/*" required>
    <progress id="progress2" value="0" max="100" class="hidden"></progress>
    <span id="status2" class="hidden">Chargement...</span>
</div>

<div class="form-group">
    <label for="description"><%= i18n.description %> (max. 820 caract√®res)</label>
    <textarea class="form-control" id="description" name="description" rows="5" maxlength="820" required></textarea>
    <small id="charCount">0/820 <%= i18n.characters %></small>
  </div>
  <button type="submit" class="btn btn-custom"><%= i18n.save %></button>
</form>

                                <div id="generatedLink" class="mt-3"></div>
                            </div>
                        </div>

                        <!-- Section Donn√©es -->
                        <div id="donnees" class="card" style="display: none;">
                            <div class="card-body">
                                <h5 class="card-title"><%= i18n.stats %></h5>
                                <p class="card-text">Cette section vous permet de suivre la performance de vos annonces immobili√®res sur les diff√©rentes plateformes de diffusion. Consultez les statistiques d√©taill√©es pour √©valuer la visibilit√© de vos annonces sur Facebook, Ads by UAP, ECA-N, et Google.</p>
                            </div>
                        </div>

                        <!-- Section Created Pages -->
                        <div id="created-pages" class="card" style="display: none;">
    <div class="card-body">
        <h5 class="card-title"><%= i18n.created_pages %></h5>
        <p class="card-text"><%= i18n.created_pages_info %></p>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th scope="col"><%= i18n.rooms %></th>
                    <th scope="col"><%= i18n.surface %></th>
                    <th scope="col"><%= i18n.price %></th>
                    <th scope="col"><%= i18n.city %></th>
                    <th scope="col"><%= i18n.country %></th>
                    <th scope="col">URL</th>
                    <th scope="col"><%= i18n.actions %></th>
                </tr>
            </thead>
            <tbody id="properties-list">
                                        <!-- Propri√©t√©s de l'utilisateur ici -->
                                    </tbody>
                                </table>
                                <div id="no-properties-message" style="display: none;" class="text-center">
                                    <p><%= i18n.no_properties_message %></p>
                                </div>
                            </div>
                        </div>
                    </div> <!-- Fin de main-section -->
                </div>
            </div>
        </div>
    </div>
</section>
</main>
    <footer class="site-footer section-padding">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-12 mb-4 pb-2">
                    <a class="navbar-brand mb-2" href="/">
                        <span>UAP Immo</span>
                    </a>
                </div>
                <div class="col-lg-3 col-md-4 col-6">
                    <h6 class="site-footer-title mb-3"><%= i18n.footer.information_title %></h6>
                    <ul class="site-footer-links">
                        <li class="site-footer-link-item"><a href="/" class="site-footer-link"><%= i18n.menu.home %></a></li>
                        <li class="site-footer-link-item"><a href="/register" class="site-footer-link"><%= i18n.footer.create_account %></a></li>
                    </ul>
                </div>
                <div class="col-lg-3 col-md-4 col-6">
                    <h6 class="site-footer-title mb-3"><%= i18n.footer.access_title %></h6>
                    <ul class="site-footer-links">
                        <li class="site-footer-link-item"><a href="/contact" class="site-footer-link"><%= i18n.menu.contact %></a></li>
                    </ul>
                </div>
                <div class="col-lg-3 col-md-4 col-12 mt-4 mt-lg-0 ms-auto">
                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false"></button>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item" href="/en/user">English</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="/fr/user">Fran√ßais</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <p class="copyright-text mt-lg-5 mt-4">Copyright ¬© 2024 UAP Company. All rights reserved.</p>
            </div>
        </div>
    </footer>
<div class="copy-message" id="copyMessage">URL copi√©e avec succ√®s !</div>

<!-- JavaScript -->
<script src="/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>
<script>
    function showSection(sectionId) {
        const sections = ['account', 'landing', 'donnees', 'created-pages', 'reset-password'];
        sections.forEach(id => {
            const sectionElement = document.getElementById(id);
            if (sectionElement) {
                sectionElement.style.display = id === sectionId ? 'block' : 'none';
            }
        });

        if (sectionId === 'created-pages') {
            loadProperties();
        }
    }

    async function loadProperties() {
    try {
        const response = await fetch('/user/properties');
        if (response.ok) {
            const properties = await response.json();
            const propertiesList = document.getElementById('properties-list');
            propertiesList.innerHTML = '';

            const noPropertiesMessage = document.getElementById('no-properties-message');
            if (properties.length === 0) {
                noPropertiesMessage.style.display = 'block';
            } else {
                noPropertiesMessage.style.display = 'none';
                properties.forEach(property => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${property.rooms}</td>
                        <td>${property.surface}</td>
                        <td>${property.price.toLocaleString('fr-FR')} ‚Ç¨</td>
                        <td>${property.city}</td>
                        <td>${property.country}</td>
                        <td><a href="${property.url}" target="_blank">${property.url}</a></td>
                        <td>
                            <div class="action-icons">
                                <i class="bi bi-clipboard" style="color: #333;" onclick="copyURL('${property.url}')"></i>
                                <% orders.forEach(order => { %>
    <i class="fa fa-shopping-cart" style="color: #333;" onclick="testURL('<%= order.orderNumber %>')"></i>
<% }) %>
                                <i class="fa fa-pencil-alt" style="color: #333;" onclick="editProperty('${property._id}')"></i>
                            </div>
                        </td>
                    `;
                    propertiesList.appendChild(row);
                });
            }
        } else {
            const propertiesList = document.getElementById('properties-list');
            propertiesList.innerHTML = '<tr><td colspan="7" class="text-center">Erreur lors du chargement des propri√©t√©s.</td></tr>';
        }
    } catch (error) {
        const propertiesList = document.getElementById('properties-list');
        propertiesList.innerHTML = '<tr><td colspan="7" class="text-center">Une erreur est survenue lors du chargement des propri√©t√©s.</td></tr>';
    }
}


    function copyURL(url) {
        const fullUrl = `https://uap.immo${url}`;
        navigator.clipboard.writeText(fullUrl)
            .then(() => {
                showCopyMessage();
            })
            .catch(err => {
                console.error('Impossible de copier l\'URL : ', err);
            });
    }

    function showCopyMessage() {
        const copyMessage = document.getElementById('copyMessage');
        copyMessage.style.display = 'block';
        setTimeout(() => {
            copyMessage.style.display = 'none';
        }, 2000);
    }

function testURL(orderId) {
    if (!orderId || orderId.length !== 24) {
        console.error("‚ùå OrderId non valide :", orderId);
        alert("Erreur : l'ID de commande est invalide.");
        return;
    }

    console.log("üîç ID de la commande cliqu√© :", orderId);

    const currentLang = window.location.pathname.split('/')[1];

    if (currentLang === 'en' || currentLang === 'fr') {
        window.location.href = `/${currentLang}/payment?orderId=${orderId}`;
    } else {
        window.location.href = `/payment?orderId=${orderId}`;
    }
}


    function editProperty(propertyId) {
        window.location.href = `/property/edit/${propertyId}`;
    }
document.getElementById('add-property-form').addEventListener('submit', async function(event) {
  event.preventDefault();
  const formData = new FormData(this);

  try {
    const response = await fetch('/add-property', {
      method: 'POST',
      body: formData
    });
    
    const result = await response.text();  // R√©cup√©rer la r√©ponse sous forme de texte HTML
    document.getElementById('generatedLink').innerHTML = result;  // Afficher le message sous le formulaire
  } catch (error) {
    console.error('Erreur lors de l\'ajout de la propri√©t√© :', error);
  }
});


    // Temps en millisecondes (5 minutes)
    const inactivityTime = 5 * 60 * 1000;
    let timeout;

    function resetTimer() {
        clearTimeout(timeout);
        timeout = setTimeout(logout, inactivityTime);
    }

    function logout() {
    const locale = document.documentElement.lang || 'fr'; // R√©cup√®re la langue de la page
    window.location.href = `/${locale}/login`;
}

    window.onload = resetTimer;
    document.onmousemove = resetTimer;
    document.onkeypress = resetTimer;
    document.onclick = resetTimer;
    document.onscroll = resetTimer;
</script>
<script>
  const descriptionInput = document.getElementById('description');
  const charCount = document.getElementById('charCount');

  descriptionInput.addEventListener('input', function() {
    charCount.textContent = `${descriptionInput.value.length}/820 caract√®res`;
  });
</script>
<script>
  document.getElementById('add-property-form').addEventListener('submit', function(event) {
      let missingFields = [];
      const requiredFields = ['price', 'surface', 'country', 'city', 'propertyType', 'description'];
      
      requiredFields.forEach(field => {
          const input = document.getElementById(field);
          if (!input.value.trim()) {
              missingFields.push(field);
              input.style.border = "2px solid red";  // Mets en rouge les champs vides
          } else {
              input.style.border = "";  // Remets la bordure normale si rempli
          }
      });

      if (missingFields.length > 0) {
          event.preventDefault(); // Emp√™che l'envoi du formulaire
          alert("Veuillez remplir tous les champs obligatoires avant de soumettre le formulaire.");
      }
  });
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    function handleFileUpload(input, progressId, statusId) {
        const file = input.files[0];

        if (file) {
            const progressBar = document.getElementById(progressId);
            const status = document.getElementById(statusId);

            // R√©initialisation
            progressBar.value = 0;
            progressBar.classList.remove("hidden");
            status.classList.remove("hidden");
            status.textContent = "Chargement en cours...";

            // Simulation d'upload progressif (remplace √ßa par une vraie requ√™te si besoin)
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                progressBar.value = progress;

                if (progress >= 100) {
                    clearInterval(interval);
                    status.textContent = "‚úÖ Image charg√©e avec succ√®s !";
                    setTimeout(() => {
                        progressBar.classList.add("hidden");
                        status.classList.add("hidden");
                    }, 2000); // Cache apr√®s 2 secondes
                }
            }, 200);
        }
    }

    // √âv√©nements sur les inputs file
    document.getElementById("photo1").addEventListener("change", function () {
        handleFileUpload(this, "progress1", "status1");
    });

    document.getElementById("photo2").addEventListener("change", function () {
        handleFileUpload(this, "progress2", "status2");
    });
});
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    loadOrderHistory();
});

function loadOrderHistory() {
    fetch('/user/orders')
    .then(response => response.json())
    .then(orders => {
        const orderTable = document.querySelector("#order-history-table tbody");
        orderTable.innerHTML = "";

        if (orders.length === 0) {
            document.getElementById("no-orders-message").style.display = "block";
        } else {
            document.getElementById("no-orders-message").style.display = "none";
            orders.forEach(order => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${new Date(order.createdAt).toLocaleDateString('fr-FR')}</td>
                    <td>${new Date(order.createdAt).toLocaleTimeString('fr-FR')}</td>
                    <td>${order.amount.toLocaleString('fr-FR', { style: 'currency', currency: 'EUR' })}</td>
                    <td>${order.status}</td>
                    <td>
                        ${order.pageUrl ? `<a href="${order.pageUrl}" target="_blank">Voir la page</a>` : 'URL non disponible'}
                    </td>
                `;
                orderTable.appendChild(row);
            });
        }
    })
    .catch(error => {
        console.error("Erreur lors du chargement des commandes :", error);
    });
}


</script>


</body>
</html>
